# The Caddyfile is an easy way to configure your Caddy web server.

#

# https://caddyserver.com/docs/caddyfile

{$NOTES_DOMAIN} {
    route {
        reverse_proxy http://localhost:3010 {
            # WebSocket support (required for Affine sync)
            header_up Upgrade {http.request.header.Upgrade}
            header_up Connection {http.request.header.Connection}
        }
    }
}

{$CHAT_DOMAIN$} {
    route {
        @webhooks {
            path /plugins/github/webhook
            path /hooks/*
        }
        reverse_proxy @webhooks http://localhost:8065 {
            header_up Upgrade {http.request.header.Upgrade}
            header_up Connection {http.request.header.Connection}
        }        
        
        reverse_proxy http://localhost:8065 {
            header_up Upgrade {http.request.header.Upgrade}
            header_up Connection {http.request.header.Connection}
        }
    }
}

{$DRIVE_DOMAIN$} {
   route {
        reverse_proxy http://localhost:8000 {
            header_up Upgrade {http.request.header.Upgrade}
            header_up Connection {http.request.header.Connection}
        }
    }
}

# As an alternative to editing the above site block, you can add your own site

# block files in the Caddyfile.d directory, and they will be included as long

# as they use the .caddyfile extension.

import Caddyfile.d/\*.caddyfile
